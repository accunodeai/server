\documentclass[a4paper,12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{geometry}
\geometry{margin=1in}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{enumitem}
\usepackage{array}
\usepackage{booktabs}
\usepackage{caption}
\usepackage{listings}
\usepackage{tikz}
\usetikzlibrary{shapes.geometric, arrows}
\usepackage{hyperref}

% Remove colors
\renewcommand{\@xobeyspaces}{\let =\space}
\makeatletter
\renewcommand{\@xobeyspaces}{\def {\ }}
\makeatother

% Custom commands for formatting
\newcommand{\sectionbreak}{\clearpage}
\newcommand{\subitem}[1]{\item[\textbullet] #1}

\begin{document}

\begin{center}
    \textbf{\Large Financial Default Risk Prediction Platform}
\end{center}

\section*{Executive Summary}

\textbf{What We're Building:} A Multi-Tenant Financial Default Risk Prediction Platform that enables organizations to predict corporate default risk using machine learning, manage financial data for multiple companies, and collaborate within organizations with role-based access.

\subsection*{Core Value Proposition}
\begin{itemize}
    \subitem ML-Powered Predictions - Annual \& quarterly default risk analysis with confidence scores
    \subitem Multi-Tenant Organizations - Complete data isolation with shared global datasets
    \subitem Team Collaboration - Invitation-based system with role management
    \subitem Bulk Processing - Excel file uploads with async processing
    \subitem Enterprise Security - JWT authentication with organization-scoped access control
\end{itemize}

\subsection*{Technology Stack}
\begin{itemize}
    \subitem Backend: FastAPI (Python) + PostgreSQL + SQLAlchemy ORM
    \subitem Caching: Redis (sessions, background jobs)
    \subitem Background Processing: Celery with Redis broker
    \subitem Authentication: JWT tokens with custom role-based access
    \subitem Email: Resend API for transactional emails
    \subitem ML: Custom models for default prediction
\end{itemize}

\section*{Key User Journeys}
\begin{itemize}
    \subitem New User → Organization Setup: Registration → Email Verification → Create Organization → Become Admin
    \subitem Team Invitation Process: Admin Sends Invite → Email Notification → User Accepts → Joins Organization
    \subitem Financial Prediction Creation: Select Company → Input Financial Ratios → ML Processing → Risk Analysis
    \subitem Bulk Data Processing: Upload Excel → Async Processing → Progress Tracking → Results Download
\end{itemize}

\sectionbreak

\section*{API Endpoints Overview}

\subsection*{Authentication APIs}
\begin{itemize}
    \subitem POST /api/register-simple - User registration
    \subitem POST /api/login - User authentication
    \subitem GET /api/me - Current user profile
\end{itemize}

\subsection*{Organization Management}
\begin{itemize}
    \subitem POST /api/v1/organizations/ - Create organization
    \subitem GET /api/v1/organizations/me - Get my organization
    \subitem GET /api/v1/organizations/{id}/members - List team members
    \subitem POST /api/v1/organizations/{id}/invitations/ - Send invitation
    \subitem GET /api/v1/organizations/{id}/invitations/ - List invitations
\end{itemize}

\subsection*{Invitation System}
\begin{itemize}
    \subitem POST /api/invitations/{token}/accept - Accept invitation
    \subitem GET /api/invitations/{token} - Get invitation details
\end{itemize}

\subsection*{Company Management}
\begin{itemize}
    \subitem GET /api/v1/companies/ - List accessible companies
    \subitem POST /api/v1/companies/ - Create new company
    \subitem GET /api/v1/companies/{id} - Get company details
\end{itemize}

\subsection*{Prediction APIs}
\begin{itemize}
    \subitem POST /api/v1/predictions/predict-annual - Create annual prediction
    \subitem POST /api/v1/predictions/predict-quarterly - Create quarterly prediction
    \subitem POST /api/v1/predictions/bulk-predict-async - Bulk processing
    \subitem GET /api/v1/predictions/job-status/{job_id} - Check processing status
    \subitem GET /api/v1/predictions/summary - Analytics dashboard
\end{itemize}

\sectionbreak

\section*{Key Features \& Benefits}

\subsection*{Advanced ML Capabilities}
\begin{itemize}
    \subitem Dual Model System: Annual and Quarterly prediction models
    \subitem Ensemble Predictions: Multiple algorithms for higher accuracy
    \subitem Risk Categorization: Automatic risk level assignment (Very Low → Very High)
    \subitem Confidence Scoring: Model certainty indicators
    \subitem Feature Importance: Understanding key risk factors
\end{itemize}

\subsection*{Enterprise Multi-Tenancy}
\begin{itemize}
    \subitem Complete Data Isolation: Organization-scoped data access
    \subitem Global Data Sharing: Public companies visible across organizations
    \subitem Flexible Team Management: Admin and user roles with granular permissions
    \subitem Scalable Architecture: Support for unlimited organizations and users
\end{itemize}

\subsection*{Bulk Processing \& Analytics}
\begin{itemize}
    \subitem Excel Import: Async processing of large financial datasets
    \subitem Progress Tracking: Real-time job status and completion estimates
    \subitem Batch Predictions: Process hundreds of companies simultaneously
    \subitem Analytics Dashboard: Risk distribution, trends, and insights
\end{itemize}

\subsection*{Security \& Compliance}
\begin{itemize}
    \subitem JWT Authentication: Secure token-based authentication
    \subitem Role-Based Access Control: Granular permission management
    \subitem Data Validation: Comprehensive input validation and sanitization
    \subitem Audit Trails: Complete activity logging and tracking
\end{itemize}

\sectionbreak

\section*{System Architecture Overview}

\subsection*{High-Level Architecture}
\begin{verbatim}
Client Layer    API Gateway    Business Logic
│               │              │
│ Web Frontend  │ FastAPI Server│ Organization
│ Mobile App    │ Authentication│ Prediction
│ API Clients   │ CORS Middleware│ ML Service
└───────────────┘ └──────────────┘ └──────────────┘
                  │              │
                  ▼              ▼
Data Layer       Background Process  External APIs
│               │              │
│ PostgreSQL    │ Celery Workers│ Resend Email
│ Redis Cache   │ Task Queue    │ ML Models
└───────────────┘ └──────────────┘ └──────────────┘
\end{verbatim}

\subsection*{Component Responsibilities}
\begin{itemize}
    \subitem FastAPI Server: RESTful APIs, request validation, authentication middleware
    \subitem Organization Service: Multi-tenant data management, team collaboration
    \subitem Prediction Service: Financial data processing, ML model integration
    \subitem Background Processing: Bulk data uploads, email notifications
    \subitem PostgreSQL: Primary data storage with proper indexing
    \subitem Redis: Session management, job queues, caching layer
\end{itemize}

\sectionbreak

\section*{User Roles \& Permissions Matrix}

\subsection*{Role Hierarchy}
\begin{tikzpicture}[level distance=1.5cm,
    level 1/.style={sibling distance=3cm},
    edge from parent/.style={draw, -latex},
    every node/.style={draw, rectangle}]
    \node {Super Admin (Global)}
        child {node {Full system access}}
        child {node {Can manage any organization}}
        child {node {Global company data management}}
        child {node {Organization Admin}
            child {node {Full organization access}}
            child {node {Team member management}}
            child {node {Organization data control}}
            child {node {Invitation management}}
            child {node {Organization User}
                child {node {Organization data access}}
                child {node {Can create predictions}}
                child {node {Limited admin functions}}
                child {node {Collaborative access}}
            }
        }
        child {node {No Organization User}
            child {node {Global data view only}}
            child {node {Can create own organization}}
            child {node {Limited functionality}}
            child {node {Personal workspace}}
        };
\end{tikzpicture}

\subsection*{Detailed Permission Matrix}
\begin{tabular}{lcccc}
\toprule
\textbf{Action} & \textbf{Super Admin} & \textbf{Org Admin} & \textbf{Org User} & \textbf{No Org User} \\
\midrule
\multicolumn{5}{l}{\textbf{Organizations}} \\
Create Organization & ✅ All & ✅ Own & ✅ New & ✅ First \\
View All Organizations & ✅ & ❌ & ❌ & ❌ \\
Delete Organization & ✅ Any & ✅ Own & ❌ & ❌ \\
\multicolumn{5}{l}{\textbf{Team Management}} \\
Send Invitations & ✅ & ✅ & ❌ & ❌ \\
Remove Members & ✅ & ✅ & ❌ & ❌ \\
Manage Roles & ✅ & ✅ & ❌ & ❌ \\
\multicolumn{5}{l}{\textbf{Companies}} \\
View Global Companies & ✅ & ✅ & ✅ & ✅ \\
View Org Companies & ✅ & ✅ & ✅ & ❌ \\
Create Global Companies & ✅ & ❌ & ❌ & ❌ \\
Create Org Companies & ✅ & ✅ & ✅ & ❌ \\
\multicolumn{5}{l}{\textbf{Predictions}} \\
View Global Predictions & ✅ & ✅ & ✅ & ✅ \\
View Org Predictions & ✅ & ✅ & ✅ & ❌ \\
Create Predictions & ✅ & ✅ & ✅ & ❌ \\
Bulk Processing & ✅ & ✅ & ✅ & ❌ \\
\bottomrule
\end{tabular}

\sectionbreak

\section*{Database Schema \& Data Model}

\subsection*{Core Entity Relationships}
\begin{tikzpicture}[node distance=1.5cm,
    every node/.style={draw, rectangle},
    edge from parent/.style={draw, -latex}]
    \node {Organizations (1)}
        child {node {Users (N)}
            child {node {Invitations (N)}}
        }
        child {node {Companies (N)}
            child {node {Predictions (N)}
                child {node {Annual \& Quarterly Types}}
            }
        };
\end{tikzpicture}

\subsection*{Key Tables Structure}
\begin{itemize}
    \subitem \textbf{organizations}
    \begin{itemize}
        \subitem id: UUID (Primary Key)
        \subitem name: Text up to 255 characters - e.g., "HDFC Bank", "ICICI Bank"
        \subitem slug: Text up to 100 characters, unique - e.g., "hdfc-bank"
        \subitem domain: Text up to 255 characters - e.g., "hdfc.com"
        \subitem is_active: Boolean, defaults to true
        \subitem max_users: Integer, defaults to 100
        \subitem created_by: UUID (links to users table)
        \subitem created_at, updated_at: Timestamps
    \end{itemize}
    \subitem \textbf{users}
    \begin{itemize}
        \subitem id: UUID (Primary Key)
        \subitem email: Text up to 255 characters, unique and indexed
        \subitem username: Text up to 100 characters, unique and indexed
        \subitem organization_id: UUID (links to organizations table), indexed
        \subitem organization_role: Enum with values 'admin' or 'user'
        \subitem global_role: Enum with values 'super_admin' or 'user'
        \subitem is_active: Boolean, defaults to true
        \subitem created_at, updated_at: Timestamps
    \end{itemize}
    \subitem \textbf{companies}
    \begin{itemize}
        \subitem id: UUID (Primary Key)
        \subitem symbol: Text up to 20 characters, unique and indexed - e.g., "RELIANCE", "TCS"
        \subitem name: Text up to 255 characters - e.g., "Reliance Industries"
        \subitem market_cap: Decimal with 20 digits, 2 after decimal
        \subitem sector: Text up to 100 characters - e.g., "Energy", "Technology"
        \subitem organization_id: UUID (links to organizations table), indexed
        \subitem is_global: Boolean, defaults to false, indexed
    \end{itemize}
    \subitem \textbf{predictions (Annual \& Quarterly)}
    \begin{itemize}
        \subitem id: UUID (Primary Key)
        \subitem company_id: UUID (links to companies table)
        \subitem organization_id: UUID (links to organizations table), indexed
        \subitem reporting_year: Text up to 4 characters - e.g., "2024"
        \subitem reporting_quarter: Text up to 2 characters - e.g., "Q1", "Q2", "Q3", "Q4"
        \subitem probability: Decimal with 5 digits, 4 after decimal - 0.0 to 1.0
        \subitem risk_level: Text up to 20 characters - e.g., "Low", "Medium", "High"
        \subitem confidence: Decimal with 5 digits, 4 after decimal
        \subitem predicted_at: Timestamp
        \subitem created_by: UUID (links to users table)
    \end{itemize}
\end{itemize}

\subsection*{Data Access Rules}
\begin{itemize}
    \subitem Global Companies (is_global=true): Visible to all organizations
    \subitem Organization Companies (organization_id=specific): Only visible to that organization
    \subitem Personal Companies (organization_id=null): Creator only access
    \subitem Predictions: Follow parent company access rules
\end{itemize}

\sectionbreak

\section*{Complete User Flow Workflows}

\subsection*{Complete User Flow \& Application Architecture}
\begin{tikzpicture}[node distance=1.5cm]
    \node[draw, rectangle] (start) {👤 New User};
    \node[draw, rectangle, right of=start] (reg) {📝 Register Account};
    \node[draw, diamond, right of=reg] (verify) {📧 Email Verified?};
    \node[draw, rectangle, above right of=verify] (login) {🔑 Login Success};
    \node[draw, rectangle, below right of=verify] (email_verify) {📧 Verify Email};
    \node[draw, diamond, right of=login] (org_check) {🏢 Has Organization?};
    \node[draw, rectangle, below right of=org_check] (create_org) {🏗️ Create Organization};
    \node[draw, rectangle, right of=create_org] (org_admin) {👑 Become Org Admin};
    \node[draw, rectangle, above right of=org_check] (org_user) {👥 Access Organization};
    \node[draw, rectangle, right of=org_admin] (invite_team) {📧 Invite Team Members};
    \node[draw, rectangle, right of=invite_team] (send_invite) {📤 Send Invitation Email};
    \node[draw, rectangle, right of=send_invite] (new_member) {👤 New Member};
    \node[draw, diamond, right of=new_member] (accept_invite) {✅ Accept Invitation?};
    \node[draw, rectangle, above right of=accept_invite] (join_org) {🤝 Join Organization};
    \node[draw, rectangle, below right of=accept_invite] (expire) {⏰ Invitation Expires};

    \draw[->] (start) -- (reg);
    \draw[->] (reg) -- (verify);
    \draw[->] (verify) -- node[above] {Yes} (login);
    \draw[->] (verify) -- node[below] {No} (email_verify);
    \draw[->] (email_verify) -- (login);
    \draw[->] (login) -- (org_check);
    \draw[->] (org_check) -- node[above] {Yes} (org_user);
    \draw[->] (org_check) -- node[below] {No} (create_org);
    \draw[->] (create_org) -- (org_admin);
    \draw[->] (org_admin) -- (invite_team);
    \draw[->] (invite_team) -- (send_invite);
    \draw[->] (send_invite) -- (new_member);
    \draw[->] (new_member) -- (accept_invite);
    \draw[->] (accept_invite) -- node[above] {Yes} (join_org);
    \draw[->] (accept_invite) -- node[below] {No} (expire);
    \draw[->] (join_org) -- (org_user);
\end{tikzpicture}

\subsection*{System Architecture \& Multi-Tenant User Roles}
\begin{tikzpicture}[node distance=1.5cm]
    \node[draw, rectangle] (super_admin) {👑 Super Admin};
    \node[draw, rectangle, below of=super_admin] (org_a) {🏢 Organization A - HDFC Bank};
    \node[draw, rectangle, below of=org_a] (admin_a) {👑 Org Admin};
    \node[draw, rectangle, below of=admin_a] (user_a) {👤 Org User};
    \node[draw, rectangle, right of=org_a] (org_b) {🏢 Organization B - ICICI Bank};
    \node[draw, rectangle, below of=org_b] (admin_b) {👑 Org Admin};
    \node[draw, rectangle, below of=admin_b] (user_b) {👤 Org User};
    \node[draw, rectangle, right of=org_b] (no_org_user) {👤 Independent User};

    \draw[->] (super_admin) -- (org_a);
    \draw[->] (super_admin) -- (org_b);
    \draw[->] (org_a) -- (admin_a);
    \draw[->] (org_a) -- (user_a);
    \draw[->] (org_b) -- (admin_b);
    \draw[->] (org_b) -- (user_b);
    \draw[->] (super_admin) -- (no_org_user);
\end{tikzpicture}

\end{document}